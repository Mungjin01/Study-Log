## ****Matrix Chain Multiplication(행렬 곱셈 순서 문제)****

어떤 다수의 행렬이 있을 때, 괄호를 어디에 위치시키는지에 따라 최종 결과는 같지만 곱셈의 계산량이 달라진다. 왜냐하면 행렬을 곱하기 위해서는 행렬의 크기가 중요한데, 예를 들어 p*q 행렬을 q*r 행렬과 곱한다면 총 연산 횟수는 p*q*r이 되기 때문 

ex) 3가지 행렬이 있다. 행렬의 크기는 다음과 같다.

A = p * q

B = q * r

C = r * s

괄호를 통해 세 행렬의 곱이 가질 수 있는 경우의 수는 총 두 가지이다.

- (A * B) * C
    - 연산 횟수 : p*q*r + p*r*s = p*r*(q+s)
- A * (B * C)
    - 연산 횟수 : q*r*s + p*q*s = (p+r)*q*s

두 가지 경우의 수밖에 없으니 큰 차이가 없어 보이겠지만, 행렬의 갯수가 늘어남에 따라, 그리고 행렬의 크기에 따라 연산 횟수에는 큰 차이가 있다. 

### 부분 수열(subsequence)을 이용

1. 전체 행렬에 있어, 2개의 부분수열로 분리
2. 각 부분수열에 있어, 최소 비용을 구한 후 합쳐준다.
3. 분리할 수 있을 때까지 부분수열의 길이를 늘려주면서 이 과정을 반복

<aside>
💡 m[i][j] = 행렬 i번에서 j번까지의 최소 비용, d = 행렬 크기

=> m[i][j] = m[i][k] + m[k + 1][j] + d[i - 1] * d[k] * d[j]

</aside>

시간복잡도는 O(n^3)

1. i, j의 거리가 1일때

M[1,2] = 2 x 4 x 1 = 8 (k = 1)

M[2,3] = 4 x 1 x 3 = 12 (k = 2)

M[3,4] = 1 x 3 x 4 = 12 (k = 3)

M[4,5] = 3 x 4 x 2 = 24 (k = 4)

|  | 1 | 2 | 3 | 4 | 5 |
| --- | --- | --- | --- | --- | --- |
| 1 | 0 | 8 (k = 1) |  |  |  |
| 2 |  | 0 | 12 (2) |  |  |
| 3 |  |  | 0 | 12 (3) |  |
| 4 |  |  |  | 0 | 24 (4) |
| 5 |  |  |  |  | 0 |

1. i, j의 거리가 2일 때

M[1,3] =**min**( M[1,1] + M[2,3] + d0d1d3 = 0 + 12  +2 x  4 x 3 = 20, M[1,**2**] + M[3,3] + d0d2d3 = 8 x 0 + 2 x 1 x 3 =**14**) = 14 (k = 2)

M[2,4] = min ( M[2,2] + M[3,4] + d1d2d4 = 0 + 12 + 4 x 1 x 4 = 28, M[2,3] + M[4,4] + d1d3d4 = 12 +0 + 4 x 3 x 4 =60 ) = 28 (k =2)

M[3,5] = min ( M[3,3] + M[4,5] + d2d3d5 = 0 + 24 + 1 x 3 x 2 = 30, M[3,4] + M[5,5] + d2d4d5 = 12 + 0 + 1 x 4 x 2 = 20) = 20 (k = 4)

|  | 1 | 2 | 3 | 4 | 5 |
| --- | --- | --- | --- | --- | --- |
| 1 | 0 | 8 (k = 1) | 14 (2) |  |  |
| 2 |  | 0 | 12 (2) | 28 (2) |  |
| 3 |  |  | 0 | 12 (3) | 20 (4) |
| 4 |  |  |  | 0 | 24 (4) |
| 5 |  |  |  |  | 0 |
1. i, j의 거리가 3일 때

M[1,4] = min (M[1,1] + M[2,4] + d0d1d = 0 + 28 + 2 x 4 x 4 = 56,

                      M[1,2] + M[3,4] + d0d2d4 = 8 + 12 + 2 x 1 x 4 = 28,

                      M[1,3] + M[4,4] + d0d3d4 = 14 + 0 + 2 x 3 x 4 = 38) = 28 (k =2)

M[2,5] = min (M[2,2] + M[3,5] + d1d2d5 = 0 + 20 + 4 x 1 x 2 = 28,

                      M[2,3] + M[4,5] + d1d3d5 = 12 + 24 + 4 x 3 x 2 = 60, 

                      M[2,4] + M[5,5] + d1d4d5 = 28 + 0 + 1 x 4 x 2 = 36) = 28 (k = 2)

|  | 1 | 2 | 3 | 4 | 5 |
| --- | --- | --- | --- | --- | --- |
| 1 | 0 | 8 (k = 1) | 14 (2) | 28 (2) |  |
| 2 |  | 0 | 12 (2) | 28 (2) | 28 (2) |
| 3 |  |  | 0 | 12 (3) | 20 (4) |
| 4 |  |  |  | 0 | 24 (4) |
| 5 |  |  |  |  | 0 |

4. i,j의 거리가 4일 때

M[1,5] = min (M[1,1] + M[2,5] + d0d1d5 = 0 + 28 + 2 x 4 x 2 = 44,

                      M[1,2] + M[3,5] + d0d2d5 = 8 + 20 + 2 x 1  x 2 = 32,

                      M[1,3] + M[4,5] + d0d3d5 = 14 + 24 + 2 x 3 x 2 =50,

                      M[1,4] + M[5,5] + d0d4d5 = 28 + 0 + 2 x 4 x 2  = 44) = 32 (k = 2)

|  | 1 | 2 | 3 | 4 | 5 |
| --- | --- | --- | --- | --- | --- |
| 1 | 0 | 8 (k = 1) | 14 (2) | 28 (2) | 32 (2) |
| 2 |  | 0 | 12 (2) | 28 (2) | 28 (2) |
| 3 |  |  | 0 | 12 (3) | 20 (4) |
| 4 |  |  |  | 0 | 24 (4) |
| 5 |  |  |  |  | 0 |
